"use strict";const n=require("electron"),t=require("node:path"),r=require("node:child_process");process.env.DIST=t.join(__dirname,"../dist");process.env.VITE_PUBLIC=n.app.isPackaged?process.env.DIST:t.join(process.env.DIST,"../public");let e,o=null;function l(){if(n.app.isPackaged){const i=process.platform==="win32"?"diandian-engine.exe":"diandian-engine";return t.join(process.resourcesPath,"bin",i)}return t.join(__dirname,"../engine/server.py")}function c(){const i=l();if(console.log("Starting Python Engine from:",i),n.app.isPackaged)o=r.spawn(i,[],{cwd:t.dirname(i),stdio:["ignore","pipe","pipe"]});else{const s=process.platform==="win32"?"python":"python3";o=r.spawn(s,[i],{cwd:t.dirname(i),stdio:["ignore","pipe","pipe"]})}o.stdout&&o.stdout.on("data",s=>{console.log(`[Python Engine]: ${s.toString()}`)}),o.stderr&&o.stderr.on("data",s=>{console.error(`[Python Engine Error]: ${s.toString()}`)}),o.on("close",s=>{console.log(`Python process exited with code ${s}`),o=null})}function a(){o&&(console.log("Stopping Python Engine..."),o.kill(),o=null)}function p(){e=new n.BrowserWindow({width:1200,height:800,frame:!1,titleBarStyle:"hidden",webPreferences:{preload:t.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0}}),n.ipcMain.on("window-minimize",()=>e==null?void 0:e.minimize()),n.ipcMain.on("window-maximize",()=>{e!=null&&e.isMaximized()?e.unmaximize():e==null||e.maximize()}),n.ipcMain.on("window-close",()=>e==null?void 0:e.close()),e.webContents.on("did-finish-load",()=>{e==null||e.webContents.send("main-process-message",new Date().toLocaleString())});const i=process.env.VITE_DEV_SERVER_URL;i?(e.loadURL(i),e.webContents.openDevTools()):e.loadFile(t.join(process.env.DIST||"","index.html"))}n.app.on("window-all-closed",()=>{a(),process.platform!=="darwin"&&n.app.quit()});n.app.on("activate",()=>{n.BrowserWindow.getAllWindows().length===0&&p()});n.app.whenReady().then(()=>{c(),p()});n.app.on("will-quit",()=>{a()});
